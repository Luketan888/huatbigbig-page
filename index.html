<script>
    document.getElementById("claimForm").addEventListener("submit", function(event) {
        event.preventDefault();
        // Gather form data
        const name = document.getElementById("name").value;
        const sex = document.getElementById("sex").value;
        const age = document.getElementById("age").value;
        const email = document.getElementById("email").value;
        const message = document.getElementById("message").value;
        
        // URL encode the message to handle special characters
        const githubMessage = encodeURIComponent(`
            Free Meal Claim Details:
            Name: ${name}
            Sex: ${sex}
            Age: ${age}
            Email: ${email}
            Message: ${message}
        `);
        
        // GitHub API URL to trigger the workflow
        const githubApiUrl = `https://api.github.com/repos/Luketan888/huatbigbig-page/dispatches`;
        
        // Send data to GitHub API to trigger workflow
        fetch(githubApiUrl, {
            method: 'POST',
            headers: {
                'Accept': 'application/vnd.github.v3+json',
                'Authorization': `token ${process.env.MY_GITHUB_TOKEN}` // Use environment variable
            },
            body: JSON.stringify({
                event_type: 'send_telegram_message',
                client_payload: {
                    message: githubMessage
                }
            })
        })
        .then(response => {
            if (!response.ok) {
                throw new Error('GitHub API request failed');
            }
            return response.text();
        })
        .then(data => {
            document.getElementById("confirmationMessage").textContent = 
                "Thank you! Your details have been sent to Zhi Quan. Enjoy your meal!";
        })
        .catch(error => {
            document.getElementById("confirmationMessage").textContent = 
                "Oops! Something went wrong. Please try again later.";
            console.error('Error triggering GitHub Actions:', error);
        });
    });
</script>
